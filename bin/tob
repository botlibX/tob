#!/usr/bin/env python3
# This file is placed in the Public Domain.


import os
import sys


sys.path.insert(0, os.getcwd())


from tob.clients import Client
from tob.command import Commands, Mods, command, parse, scanner
from tob.handler import Event


class Config:

    pass


Mods.add("mods")


class CLI(Client):

    def __init__(self):
        Client.__init__(self)
        self.register("command", command)

    def raw(self, txt):
        print(txt.encode('utf-8', 'replace').decode("utf-8"))


def control():
    if len(sys.argv) == 1:
        return
    parse(Config, " ".join(sys.argv[1:]))
    scanner()
    Commands.add(cmd)
    csl = CLI()
    evt = Event()
    evt.orig = repr(csl)
    evt.txt = " ".join(sys.argv[1:])
    evt.type = "command"
    command(evt)
    evt.wait()


def cmd(event):
    event.reply(",".join(sorted(Commands.names or Commands.cmds)))


if __name__ == "__main__":
    control()
